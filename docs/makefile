SHELL = /usr/bin/env bash

# configure engine
pandocEngine = pdflatex
HTMLVersion = html5

pantable = pantable
pantable2csv = pantable2csv

CSSURL:=https://cdn.jsdelivr.net/gh/ickc/markdown-latex-css

# command line arguments
pandocArgCommon = -f markdown+autolink_bare_uris-fancy_lists --toc -V linkcolorblue -V citecolor=blue -V urlcolor=blue -V toccolor=blue --pdf-engine=$(pandocEngine) -M date="`date "+%B %e, %Y"`"
## TeX/PDF
pandocArgFragment = $(pandocArgCommon) --filter=$(pantable)
### pandoc workflow
pandocArgStandalone = $(pandocArgFragment) --toc-depth=1 -s -N
## HTML/ePub
pandocArgHTML = $(pandocArgFragment) -t $(HTMLVersion) --toc-depth=2 -s -N -c $(CSSURL)/css/common.min.css -c $(CSSURL)/fonts/fonts.min.css
# GitHub README
pandocArgReadmeGitHub = $(pandocArgFragment) --toc-depth=2 -s -t markdown_github --reference-location=block
pandocArgReadmePypi = $(pandocArgFragment) -s -t rst --reference-location=block -f markdown+autolink_bare_uris-fancy_lists-implicit_header_references

docsAll = README.pdf index.html ../README.md ../README.rst

# Main Targets ########################################################################################################################################################################################

all: $(docsAll)

clean:
	rm -f $(docsAll)

# Making dependancies #################################################################################################################################################################################

%.pdf: %.md
	pandoc $(pandocArgStandalone) -o $@ $<
%.html: %.md
	pandoc $(pandocArgHTML) $< -o $@

# readme
## index.html
index.html: badges.markdown README.md
	pandoc $(pandocArgHTML) $^ -o $@
## GitHub README
../README.md: badges.markdown README.md
	printf "%s\n\n" "<!--This README is auto-generated from \`docs/README.md\`. Do not edit this file directly.-->" > $@
	pandoc $(pandocArgReadmeGitHub) $^ >> $@
## PyPI README
../README.rst: badges.markdown README.md
	printf "%s\n\n" ".. This README is auto-generated from \`docs/README.md\`. Do not edit this file directly." > $@
	pandoc $(pandocArgReadmePypi) $^ >> $@
../README.html: ../README.rst
	rst2html.py $< > $@

print-%:
	$(info $* = $($*))
